{% extends 'testtemp/layout.html' %}
{% block content %}
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">期限が近づいたタスクあり</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <table width="100%" class="table table-lignt table-bordered modal-body">
        <thead>
          <tr>
            <th width="45%" class="text-center align-middle">タスク名</th>
            <th width="20%" class="text-center align-middle">期限日</th>
            <th width="15%" class="text-center align-middle">時間</th>
            <th width="20%" class="text-center align-middle">状態</th>
          </tr>
        </thead>
        <tbody class="modal-tasks">
        </tbody>
      </table>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

  <div class="container vh-100 px-2 py-0">
    <div class="row h-auto justify-content-center align-items-start mb-4">
      <div class="col-12 col-md-10 col-lg-8 bg-dark page-title text-center p-3 mb-1 rounded">
        <h3 class="font-size-l text-white m-0">マイタスク</h3>
      </div>
      <div class="col-12 col-md-8 col-lg-6 col-xl-5">
        <div class="deadline-set d-flex flex-row justify-content-end align-items-end mb-1">
            <a href="{{ url_for('setting') }}"><button type="button" class="btn btn-outline-primary btn-sm border-2">期限時間設定</button></a>
        </div>
        <div class="sort_buttons d-flex flex-row justify-content-end align-items-end px-0 py-1 gap-2"> 
          <h4 class="font-size-m m-auto">未完了タスク</h4>
          <a href="{{ url_for('button_click', flg=1) }}"><button type="button" class="btn btn-outline-warning btn-sm border-2">重要度順</button></a>
          <a href="{{ url_for('button_click', flg=2) }}"><button type="button" class="btn btn-outline-secondary btn-sm border-2">日付順</button></a>
        </div>
        <table width="100%" class="table table-light table-hover table-bordered">
          <thead>
            <tr>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">#</th>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">タスク名</th>
              <th colspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">期限</th>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">重要度</th>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">操作</th>
            </tr>
            <tr>
              <th scope="col" class="p-0 p-md-0 text-center align-middle">日</th>
              <th scope="col" class="p-0 p-md-0 text-center align-middle">時間</th>
            </tr>
          </thead>
          <tbody>
            {% for nc_task in nc_tasks %}
              <tr class="nc-task-item" data-deadline="{{ nc_task['deadline'] }}" data-task-id="{{ nc_task['task_id']}}">
                <th width="10%" scope="row" class="px-0 p-md-2 text-center align-middle">
                  <a href="{{ url_for('check_task', task_id=nc_task['task_id']) }}" class="check_box text-decoration-none">
                    <input type="checkbox" class="check_box_fin rounded-circl px-1 py-2" onclick="window.location.href='{{ url_for('check_task', task_id=nc_task['task_id']) }}'">
                  </a>
                </th>
                <td width="40%" class="px-0 p-md-0 text-center align-middle">
                  <label class="taskname form-check-label my-auto" for="firstCheckbox">{{ nc_task['title']}}</label>
                </td>
                <td width="15%" class="px-0 p-md-0 text-center align-middle">
                  <label class="deaddate my-auto" for="deadline">{{ nc_task['deadline'] | add_weekday }}</label>
                </td>
                <td width="10%" class="px-0 p-md-0 text-center align-middle">
                  <label class="deadtime my-auto" for="deadline">{{ nc_task['deadline'].strftime('%H:%M') }}</label>
                </td>
                <td width="10%" class="px-0 p-md-0 text-center align-middle">
                  <label class="importance my-auto" for="importance">{{ nc_task['importance'] | convert_importance }}</label>
                </td>
                <td width="15%" class="px-0 p-md-0 text-center align-middle">
                  <div class="handle_buttons d-flex flex-row px-0 py-auto p-md-2 text-center justify-content-evenly align-middle gap-3 flex-grow">
                    <a href="{{ url_for('edit_task', task_id=nc_task['task_id']) }}" class="mb-1"><button type="button" class="btn btn-primary py-2 px-1">編集</button></a>
                    <a href="{{ url_for('delete_task', task_id=nc_task['task_id']) }}"><button type="button" class="btn btn-danger py-2 px-1">削除</button></a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="fixed_button text-center align-middle">
      <a href="{{ url_for('add_task')}}">
      <button type="button" class="btn btn-primary font-size-l rounded-circle">+</button></a>
    </div>

    <div class="row h-auto justify-content-center align-items-start">
      <div class="col-12 col-md-8 col-lg-6 col-xl-5">
        <div class="sort_buttons d-flex flex-row justify-content-end align-items-end px-0 py-1 gap-2"> 
        <h4 class="font-size-m m-auto">完了済みタスク</h4>
        <a href="{{ url_for('button_click', flg=3) }}"><button type="button" class="btn btn-outline-warning border-2 btn-sm">重要度順</button></a>
        <a href="{{ url_for('button_click', flg=4) }}"><button type="button" class="btn btn-outline-secondary border-2 btn-sm">日付順</button></a>
        </div>
        <table width="100%" class="table table-light table-hover table-bordered">
          <thead>
            <tr>
              {# <th rowspan="2" scope="col" class="p-0 p-md-2 text-center align-middle">#</th> #}
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">タスク名</th>
              <th colspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">期限</th>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">重要度</th>
              <th rowspan="2" scope="col" class="p-0 p-md-0 text-center align-middle">操作</th>
            </tr>
            <tr>
              <th scope="col" class="p-0 p-md-0 text-center align-middle">日</th>
              <th scope="col" class="p-0 p-md-0 text-center align-middle">時間</th>
            </tr>
          </thead>
          <tbody>
            {% for c_task in c_tasks %}
              <tr>
                <td width="50%" class="px-0 p-md-0 text-center align-middle">
                  <label class="comp_task_name" for="firstCheckbox">{{ c_task['title']}}</label>
                </td>
                <td width="15%" class="px-0 p-md-0 text-center align-middle">
                  <label class="comp_task_deadline" for="deadline">{{ c_task['deadline'] | add_weekday }}</label>
                </td>
                <td width="10%"class="px-0 p-md-0 text-center align-middle">
                  <label class="comp_task_deadline" for="deadline">{{ c_task['deadline'].strftime('%H:%M')}}</label>
                </td>
                <td width="10%"class="px-0 p-md-0 text-center align-middle">
                  <label class="importance my-auto" for="importance">{{ c_task['importance'] | convert_importance }}</label>
                </td>
                <td width="15%" class="handle_buttons px-0 p-md-0 text-center align-middle">
                  <div class="d-flex flex-row px-0 py-auto p-md-2 text-center justify-content-evenly align-middle gap-3 flex-grow">

                    <a href="{{ url_for('check_task', task_id=c_task['task_id']) }}" class="mb-1">
                  <button type="button" class="btn btn-gray text-light py-2 px-1">戻す</button>
                    </a>
                    <a href="{{ url_for('delete_task', task_id=c_task['task_id']) }}"><button type="button" class="btn btn-danger py-2 px-1">削除</button></a>
                  </div>

                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    const dl_time = {{ session.get('dl_time') }};
    sessionStorage.setItem('dl_time', dl_time);
  </script>
{% endblock %}
